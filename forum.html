<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Forum Â· æ˜¥æ¸¸å°åˆ†é˜Ÿ</title>
  <style>
    html, body { height:100%; margin:0; font-family: Arial, Helvetica, sans-serif; }
    body { overflow-x:hidden; color:#fff; }

    /* èƒŒæ™¯ç²’å­å±‚ */
    canvas#bg {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      z-index: -2;
      background: linear-gradient(
        135deg,
        #fdfbfb,
        #ebedee
      );
    }


    /* è½»å¾®é®ç½©ï¼šè®©æ–‡å­—æ›´æ¸…æ™° */
    .overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(
        circle at top,
        rgba(255,255,255,0.6),
        rgba(255,255,255,0.15)
      );
      z-index: -1;
      pointer-events: none;
    }


    header{
      padding: 18px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      background: rgba(255,255,255,0.75);
      color: #222;
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(0,0,0,0.08);
    }

    .left h1{ margin:0; font-size:18px; font-weight:700; }
    .left p{ margin:4px 0 0; font-size:12px; opacity:.85; }

    .controls{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    button, a.btn{
      appearance:none;
      border:none;
      border-radius: 10px;
      padding:10px 12px;
      background: rgba(255,255,255,.14);
      color:#fff;
      cursor:pointer;
      font-weight:600;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    button:hover, a.btn:hover{ background: rgba(255,255,255,.22); }

    main{
      max-width: 980px;
      margin: 22px auto;
      padding: 16px;
    }

    .card{
      background: rgba(255,255,255,0.85);
      color: #222;
      border: 1px solid rgba(0,0,0,0.08);
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.12);
    }

    .hint{
      margin: 0 0 10px;
      font-size: 13px;
      opacity: .9;
      line-height: 1.5;
    }

    /* giscus å®¹å™¨ */
    #giscus-wrap{
      margin-top: 12px;
    }

    /* ç§»åŠ¨ç«¯ */
    @media (max-width: 600px){
      header{ align-items:flex-start; flex-direction:column; }
      .controls{ width:100%; justify-content:flex-start; }
    }
  </style>
</head>

<body>
  <canvas id="bg"></canvas>
  <div class="overlay"></div>

  <header>
    <div class="left">
      <h1>å…±äº«ç•™è¨€æ¿ / Forum</h1>
    </div>

    <div class="controls">
      <a class="btn" href="index.html">â† è¿”å›é¦–é¡µ</a>
      <button id="playBtn">â–¶ æ’­æ”¾éŸ³ä¹</button>
      <button id="muteBtn">ğŸ”‡ é™éŸ³</button>
    </div>
  </header>

  <main>
    <div class="card">
      <p class="hint">
        è¯´æ˜ï¼šè¿™é‡Œä½¿ç”¨ <b>giscus</b>ï¼ˆåŸºäº GitHub Discussionsï¼‰ã€‚<br/>
        ä½ å¯ä»¥æŠŠå®ƒå½“æˆâ€œå…±äº«ç•™è¨€æ¿â€ï¼Œä»»ä½•äººç”¨ GitHub ç™»å½•åéƒ½èƒ½ç•™è¨€ï¼ˆå–å†³äºä½ çš„ä»“åº“/Discussion æƒé™è®¾ç½®ï¼‰ã€‚
      </p>

      <!-- giscus -->
      <div id="giscus-wrap">
        <script src="https://giscus.app/client.js"
          data-repo="71Qin/JobEntertainment"
          data-repo-id="R_kgDOQt7F2w"
          data-category="General"
          data-category-id="DIC_kwDOQt7F284C0Mzm"
          data-mapping="pathname"
          data-strict="0"
          data-reactions-enabled="1"
          data-emit-metadata="0"
          data-input-position="bottom"
          data-theme="preferred_color_scheme"
          data-lang="zh-CN"
          crossorigin="anonymous"
          async>
        </script>
      </div>
    </div>
  </main>

  <!-- èƒŒæ™¯éŸ³ä¹ -->
  <audio id="bgm" preload="auto" loop playsinline>
    <source src="assets/I Miss You-ç½—ç™¾å‰&å®è´.m4a" type="audio/mp4">
  </audio>

  <script>
    /* ========= 1) ç²’å­èƒŒæ™¯ï¼ˆä¼šéšèŠ‚å¥å˜åŒ–é¢œè‰²ï¼‰ ========= */
    const canvas = document.getElementById('bg');
    const ctx = canvas.getContext('2d', { alpha: true });

    function resize(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      canvas.width = Math.floor(window.innerWidth * dpr);
      canvas.height = Math.floor(window.innerHeight * dpr);
      canvas.style.width = window.innerWidth + 'px';
      canvas.style.height = window.innerHeight + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    window.addEventListener('resize', resize);
    resize();

    const particles = [];
    const COUNT = 180;

    function rand(min, max){ return Math.random() * (max - min) + min; }

    function initParticles(){
      particles.length = 0;
      for(let i=0;i<COUNT;i++){
        particles.push({
          x: rand(0, window.innerWidth),
          y: rand(0, window.innerHeight),
          vx: rand(-0.6, 0.6),
          vy: rand(-0.6, 0.6),
          r: rand(1.2, 3.2),
          hue: rand(0, 360),
        });
      }
    }
    initParticles();

    let beat = 0;      // 0~1 èŠ‚å¥å¼ºåº¦
    let globalHue = 0; // å…¨å±€è‰²ç›¸

    function draw(){
      ctx.clearRect(0,0,window.innerWidth, window.innerHeight);

      // èƒŒæ™¯è½»å¾®æ¸å˜ï¼ˆé¿å…â€œçº¯é»‘â€è§‚æ„Ÿï¼‰
      const g = ctx.createRadialGradient(
        window.innerWidth*0.5, window.innerHeight*0.2, 0,
        window.innerWidth*0.5, window.innerHeight*0.5, Math.max(window.innerWidth, window.innerHeight)
      );
      g.addColorStop(0, `hsla(${(globalHue+30)%360}, 90%, 55%, 0.16)`);
      g.addColorStop(1, `hsla(${(globalHue+210)%360}, 90%, 35%, 0.06)`);
      ctx.fillStyle = g;
      ctx.fillRect(0,0,window.innerWidth, window.innerHeight);

      // ç²’å­
      for(const p of particles){
        p.x += p.vx * (1 + beat*1.2);
        p.y += p.vy * (1 + beat*1.2);

        // è¾¹ç•Œå¾ªç¯
        if(p.x < -20) p.x = window.innerWidth + 20;
        if(p.x > window.innerWidth + 20) p.x = -20;
        if(p.y < -20) p.y = window.innerHeight + 20;
        if(p.y > window.innerHeight + 20) p.y = -20;

        // ç²’å­é¢œè‰²è·Ÿç€éŸ³ä¹ï¼šglobalHue + è‡ªèº«åç§»
        const hue = (globalHue + p.hue) % 360;
        const alpha = 0.35 + beat * 0.35;
        const radius = p.r * (1 + beat*1.3);

        ctx.beginPath();
        ctx.arc(p.x, p.y, radius, 0, Math.PI*2);
        ctx.fillStyle = `hsla(${hue}, 85%, 65%, ${0.5 + beat * 0.3})`;
        ctx.fill();
      }

      // è¿çº¿ï¼ˆæ›´æœ‰â€œå½©è‰²ç²’å­â€æ„Ÿè§‰ï¼‰
      for(let i=0;i<particles.length;i++){
        for(let j=i+1;j<particles.length;j++){
          const a = particles[i], b = particles[j];
          const dx = a.x - b.x, dy = a.y - b.y;
          const d2 = dx*dx + dy*dy;
          const maxD = 120;
          if(d2 < maxD*maxD){
            const d = Math.sqrt(d2);
            const t = 1 - d/maxD;
            const hue = (globalHue + (a.hue+b.hue)/2) % 360;
            ctx.strokeStyle = `hsla(${hue}, 95%, 65%, ${(0.10 + beat*0.15)*t})`;
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(a.x, a.y);
            ctx.lineTo(b.x, b.y);
            ctx.stroke();
          }
        }
      }

      requestAnimationFrame(draw);
    }
    requestAnimationFrame(draw);

    /* ========= 2) éŸ³ä¹åˆ†æï¼šç²’å­é¢œè‰²è·Ÿç€èŠ‚å¥å˜åŒ– ========= */
    const audioEl = document.getElementById('bgm');
    const playBtn = document.getElementById('playBtn');
    const muteBtn = document.getElementById('muteBtn');

    let audioCtx = null;
    let analyser = null;
    let dataArray = null;
    let sourceNode = null;

    function setupAudioGraph(){
      if(audioCtx) return;

      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 1024;

      sourceNode = audioCtx.createMediaElementSource(audioEl);
      sourceNode.connect(analyser);
      analyser.connect(audioCtx.destination);

      dataArray = new Uint8Array(analyser.frequencyBinCount);

      // å¾ªç¯é‡‡æ ·èƒ½é‡ -> beat
      const tick = () => {
        if(analyser){
          analyser.getByteFrequencyData(dataArray);

          // è®¡ç®—ä½é¢‘èƒ½é‡ï¼ˆé¼“ç‚¹é€šå¸¸åœ¨ä½é¢‘ï¼‰
          let sum = 0;
          const n = Math.min(60, dataArray.length); // å–å‰ 60 ä¸ªé¢‘æ®µ
          for(let i=0;i<n;i++) sum += dataArray[i];
          const avg = sum / n / 255; // å½’ä¸€åŒ– 0~1

          // å¹³æ»‘ï¼Œè®©å˜åŒ–æ›´â€œèŠ‚å¥æ„Ÿâ€
          beat = beat * 0.85 + avg * 0.15;

          // è®©è‰²ç›¸éšæ—¶é—´+èŠ‚å¥ä¸€èµ·æ»šåŠ¨
          globalHue = (globalHue + 0.6 + beat*6.0) % 360;
        }
        requestAnimationFrame(tick);
      };
      requestAnimationFrame(tick);
    }

    /* ========= 3) æ’­æ”¾æ§åˆ¶ï¼ˆè§£å†³â€œéŸ³ä¹æ— æ³•æ’­æ”¾â€ï¼‰ =========
       ä½ ç°åœ¨éŸ³ä¹ä¸å“ï¼Œ99% æ˜¯å› ä¸ºï¼šæµè§ˆå™¨ç¦æ­¢é¡µé¢è‡ªåŠ¨æ’­æ”¾éŸ³é¢‘ã€‚
       å¿…é¡»ç”±ç”¨æˆ·ç‚¹å‡»æŒ‰é’®è§¦å‘ play() æ‰å…è®¸ã€‚
    */
    async function startMusic(){
      try{
        setupAudioGraph();
        // Safari/éƒ¨åˆ†æµè§ˆå™¨ï¼šéœ€è¦ resume
        if(audioCtx && audioCtx.state === 'suspended') await audioCtx.resume();
        await audioEl.play();
        playBtn.textContent = "â¸ æ­£åœ¨æ’­æ”¾";
      }catch(e){
        // å¸¸è§åŸå› ï¼šæ–‡ä»¶è·¯å¾„/æ ¼å¼/MIME/æˆ–ä»è¢«ç­–ç•¥é˜»æ­¢
        alert("æ’­æ”¾å¤±è´¥ï¼šè¯·ç¡®è®¤ music.m4a è·¯å¾„æ­£ç¡®ï¼Œå¹¶ç”¨æŒ‰é’®è§¦å‘æ’­æ”¾ã€‚");
        console.error(e);
      }
    }

    playBtn.addEventListener('click', async () => {
      if(!audioCtx || audioEl.paused){
        await startMusic();
      }else{
        audioEl.pause();
        playBtn.textContent = "â–¶ æ’­æ”¾éŸ³ä¹";
      }
    });

    muteBtn.addEventListener('click', () => {
      audioEl.muted = !audioEl.muted;
      muteBtn.textContent = audioEl.muted ? "ğŸ”ˆ å–æ¶ˆé™éŸ³" : "ğŸ”‡ é™éŸ³";
    });
  </script>
</body>
</html>
